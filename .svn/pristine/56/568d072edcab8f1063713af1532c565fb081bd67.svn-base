<template>
	<div class="audit_record">
		<section class="select-box" v-bind:class="{ 'border-none': $route.path.includes('review/audited/detail/review') }">
			<el-select v-model="search.phaseId" placeholder="请选择评比级别">
			    <el-option
			      clearable
			      v-for="item in phaseList"
			      :key="item.id"
			      :label="item.name"
			      :value="item.id">
			    </el-option>
			</el-select>
		</section>
		<div class="" v-if="recordDatas.length">
			<section class="record_item" v-for="(item, index) in recordDatas">
				<div class="audit_expert">
					评比级别：{{item.phaseName || '暂无'}}
				</div>
				<div class="audit_expert">
					评审专家：{{item.expertName || '暂无'}}
				</div>
				<div class="table-box">
					<el-table
			      	  :data="item.evaluationItemList"
			      	  border
			      	  style="width: 100%">
			      		<el-table-column prop="name" label="评审要素" width="258">
			      		</el-table-column>
			      		<el-table-column prop="description" label="评审标准" width="318">
			      		</el-table-column>
			      		<el-table-column prop="value" label="分值">
			      		</el-table-column>
			      		<el-table-column prop="score" label="评分">
			      		</el-table-column>
			    	</el-table>
			    	<dl class="total-score clearfix">
			    		<dt class="total-tit fl">总分</dt>
			    		<dd class="total-num fr">
			    			{{item.score || 0}}
			    		</dd>
			    	</dl>
			    	<dl class="comment clearfix">
			    		<dt class="comment-tit fl">评语</dt>
			    		<dd class="comment-content fr">
			    			<div class="remark">{{item.remark || '暂无评语'}}</div>
			    		</dd>
			    	</dl>
				</div>
			</section>
		</div>
		<div class="empty-block" v-else>暂无数据</div>
		<div class="btn-box">
			<button class="back-btn" @click="$router.go(-1)">返回</button>
		</div>
	</div>
</template>

<script>
    import { requestWorksReviewRecord, requestPhaseList } from '@/service/manage.js'

    export default {
        name: 'audit_record',
        data() {
            return {
                recordDatas: [], // 评审记录数据
                totalScore: 0,
                comment: '',
                search: {
                    phaseId: '',
                },
                phaseList: [],
                // ifManage: false
            }
        },
        mounted() {
            // if (this.$route.path === '/contest/manage/works/reviewRecord') {
            //     this.ifManage = true
            //     this.getPhaseList()
            // }
            this.getPhaseList()
            this.getReviewRecord()
        },
        watch: {
            search: {
                handler: function () {
                    this.getReviewRecord()
                },
                deep: true
            }
        },
        methods: {
            // 获取阶段列表
            getPhaseList() {
                requestPhaseList({ matchId: this.$route.query.id }).then((res) => {
                    if (res.data.code === 200) {
                        this.phaseList = res.data.appendInfo.list
                    }
                })
            },
            getReviewRecord() {
                const params = {
                    matchId: this.$route.query.id,
                    worksId: this.$route.query.worksId,
                    phaseId: this.search.phaseId
                }
                requestWorksReviewRecord(params).then((res) => {
                    if (res.data.code === 200) {
                        this.recordDatas = res.data.appendInfo.evaluationRecordsList
                    }
                })
            }
        }
    }
</script>

<style lang="scss">
	.audit_record {
		.el-table {
			.cell {
				text-align: center;
			}
		}
	}
</style>

<style lang="scss" scoped>
@import '~@/assets/css/scss/vars.scss';
    .audit_record {
    	// padding-top: 10px;
    	.select-box {
    		padding: 5px 15px;
    		border-bottom: 1px solid #ddd;
    		margin-bottom: 15px;
    	}
    	.border-none {
    		border: none;
    	}
    	.audit_expert {
    		font-size: 16px;
    		padding-left: 15px;
    		margin-bottom:5px;
    	}
    	.table-box {
    		padding: 15px;
    	}
		.total-score {
			border: 1px solid #dfe6ec;
			border-top: none;
			height: 40px;
			line-height: 40px;
			text-align: center;
			.total-tit {
				width: 749px;
				font-size: 16px;
				font-weight: 600;
				color: #000;
			}
			.total-num {
				box-sizing: border-box;
				width: 182px;
				height: 100%;
				line-height: 35px;
				padding: 5px 18px;
				border-left: 1px solid #dfe6ec;
			}
		}
		.comment {
			border: 1px solid #dfe6ec;
			border-top: none;
			// height: 64px;
			text-align: center;
			.comment-tit {
				line-height: 50px;
				box-sizing: border-box;
				width: 260px;
				height: 100%;
				font-size: 16px;
				font-weight: 600;
				color: #000;
			}
			.comment-content {
				width: 685px;
				height: 100%;
				min-height: 50px;
				box-sizing: border-box;
				padding: 10px 18px;
				line-height: 2em;
				word-wrap: break-word;
				border-left: 1px solid #dfe6ec;
			}
		}

		.btn-box {
			padding: 20px;
			.back-btn {
				border: 1px solid $theme-color;
				color: $theme-color;
				padding: 7px 15px;
				border-radius: 3px;
				&:hover {
					background-color: $theme-color;
					color: #fff;
				}
			}
		}
    }
    .record_item {
    	margin-bottom: 20px;
    }
</style>