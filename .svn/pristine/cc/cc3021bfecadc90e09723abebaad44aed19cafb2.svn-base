<template>
    <section id="bgcPopup">
        <h2 class="title">背景设置</h2>
        <el-upload action :show-file-list="false" :before-upload="UploadFile">
            <button class="upload-btn" type="button"> 选择照片 </button>
            <span slot="tip" class="upload-tip">
                大小不能超过{{ imgStandardFileSize }}M, 仅支持:gif、jpg、png。
                建议上传的图片像素为 1200 x 300
            </span>
        </el-upload>
        <div style="position:absolute;font-size:12px;top:90%;color:#ff4949;" v-if="imgSizeBig">
            图片大于{{ imgStandardFileSize }}M
        </div>
        <img class="preview" :src="getFileUrl(background)" v-if="background">
        <img class="preview" :src="bgc" v-else="background">
        <div class="button-group">
            <el-button type="primary" @click="save">保存</el-button>
            <el-button @click="close" class="btn2">取消</el-button>
        </div>
    </section>
</template>

<script>
    import { uploadFileSize } from '@/mixin/uploadFileSize.js'
    import bgc from 'Asset/img/common/info.png'

    export default {
        name: 'bgcPopup',
        mixins: [uploadFileSize],
        props: {
            visible: {
                type: Boolean,
                default: false
            },
            background: {
                type: String
            },
            save: Function,
            close: Function
        },
        data() {
            return {
                imgSizeBig: false,
                bgc: bgc
            }
        },
        methods: {
            UploadFile (file, fileList) {
                const fileSize = file.size
                if(fileSize < (this.imgStandardFileSize * 1024 * 1024) ) {
                    const _this = this
                    uploader.off('uploadSuccess').on('uploadSuccess', function (file, res) {
                        if(res.code === 200) {
                            _this.$emit('changeBackground', res.appendInfo.resourceId)
                            _this.imgSizeBig = false
                        }
                    })
                    uploader.off('uploadError').on('uploadError', function (file, reason) {
                        _this.$message({ message: reason.msg })
                    })
                }else {
                    this.imgSizeBig = true
                    this.$emit('changeBackground', null)
                    uploader.cancelFile(file)
                }
            }
        }
    }
</script>

<style lang='scss' scoped>
@import '~@/assets/css/scss/vars.scss';
@each $color-key, $color-value in $color-data {
    .theme-#{$color-key} {
        .upload-btn, .btn2 {
            border: 1px solid $color-value;
            color: $color-value;
        }
    }
}
#bgcPopup {
    font-size: 14px;
    .title {
        margin-bottom: 20px;
    }
    .upload-btn {
        line-height: 2.5em;
        padding: 0 1em;
        margin-right: 15px;
    }
    .upload-tip {
        color: #999;
        font-size: 12px;
        line-height: 2;
    }
    .preview {
        margin: 30px 0;
        height: 190px;
        width: 100%;
    }
    .upload-btn {
        line-height: 2.5em;
        padding: 0 1em;
        margin-right: 15px;
    }
}
</style>